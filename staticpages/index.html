<!-- HTML page for navigating the web interface -->
<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Importing jquery from Google CDN (Content Delivery Network) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration</title>
    <!-- Importing Bulma in order to style the webpage https://bulma.io/ -->
    <!-- Any html elements stating class=" " are styled using bulma -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <!-- Importing font aweseome icons -->
    <script src="https://kit.fontawesome.com/365c57e34a.js" crossorigin="anonymous"></script>
</head>

<body>
    <!-- Homepage database table selection menu -->
    <section class="hero is-light is-fullheight">
        <div class="columns is-centered" id="selection_page">
            <div class="column is-half">
                <h2 class="title is-1 has-text-centered has-text-weight-bold">
                    Database Selection
                </h2>

                <div class="box has-text-centered">
                    <span class="fa-solid fa-people-line fa-2x"></span>
                    <h3 class="subtitle">
                        Student Registration
                    </h3>

                    <button class="button is-rounded is-primary is-outlined" id="select-student-button"
                        onclick="displayStudentInfoPage()">
                        enter student portal</button>
                </div>

                <div class="box has-text-centered">
                    <span class="fa-solid fa-person-chalkboard fa-2x"></span>
                    <h3 class="subtitle ">
                        Teacher Registration
                    </h3>
                    <button class="button is-rounded is-primary is-outlined" id="select-teacher-button"
                        onclick="displayTeacherInfoPage()">
                        enter teacher portal</button>
                </div>
            </div>
        </div>


        <!-- student_info database table display menu -->
        <div class="columns is-centered" id="displayStudent" style="display:none">
            <div class="column is-half">
                <h2 class="title is-1 has-text-centered has-text-weight-bold">Student Registration</h2>
                <div class="box has-text-centered">
                    <button class=" mr-5 button is-rounded is-primary is-outlined" onclick="returnHomePage()">Return to
                        selection menu</button>

                    <button class="button is-rounded is-primary is-outlined" onclick="showCreateStudent()">Create an
                        entry</button>
                </div>

                <table class="table is-hoverable is-fullwidth" id="student_Table">
                    <tr>
                        <th>Student ID</th>
                        <th>Surname</th>
                        <th>First Name</th>
                        <th>Registered Modules</th>
                        <th></th>
                        <th></th>
                    </tr>
                </table>
            </div>
        </div>

        <!-- teacher_info database table display menu -->
        <div class="columns is-centered" id="displayTeacher" style="display:none">
            <div class="column is-half">
                <h2 class="title is-1 has-text-centered has-text-weight-bold">Teacher Registration</h2>
                <div class="box has-text-centered">
                    <button class=" mr-5 button is-rounded is-primary is-outlined" onclick="returnHomePage()">Return to
                        selection menu</button>
                    <button class=" mr-5 button is-rounded is-primary is-outlined" onclick="showCreateTeacher()">Create
                        an entry</button>
                </div>
                <table class="table is-hoverable is-fullwidth" id="teacher_Table">
                    <tr>
                        <th>Teacher ID</th>
                        <th>Surname</th>
                        <th>First Name</th>
                        <th>Instructing Modules</th>
                        <th></th>
                        <th></th>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Create/edit page Student-->
        <div class="columns is-centered" id="create-update-s" style="display:none">
            <div class="column is-half">
                <h2 class="title is-1 has-text-centered has-text-weight-bold">Edit Student Registry</h2>
                <table class="table is-fullwidth is-hoverable" id="createUpdateFormStudent">
                    <tr>
                        <td class="has-text-weight-bold">Student ID</td>
                        <td><input class="input is-primary" type="text" name="student_id" id="student_inputID" disabled
                                placeholder="Field Auto. Generated"></td>
                    </tr>
                    <tr>
                        <td class="has-text-weight-bold">Surname</td>
                        <td><input class="input is-primary" type="text" name="surname"></td>
                    </tr>
                    <tr>
                        <td class="has-text-weight-bold">First Name</td>
                        <td><input class="input is-primary" type="text" name="first_name"></td>
                    </tr>
                    <tr>
                        <td class="has-text-weight-bold">Registered Modules</td>
                        <td><input class="input is-primary" type="text" name="registered_modules"></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <button class="button mb-2 is-rounded is-primary is-outlined" id="create-button-s"
                                onclick="doCreateStudent()">Create</button>
                            <button class="button mb-2 is-rounded is-primary is-outlined" id="update-button-s"
                                onclick="doUpdateStudent()">Update</button>
                            <button class="button is-rounded is-danger is-outlined" id="cancel-button-s"
                                onclick="returnStudentInfoPage()">Cancel</button>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Create/edit page Teacher-->
        <div class="columns is-centered" id="create-update-t" style="display:none">
            <div class="column is-half">
                <h2 class="title is-1 has-text-centered has-text-weight-bold">Edit Teacher Registry</h2>
                <table class="table is-fullwidth is-hoverable" id="createUpdateFormTeacher">
                    <tr>
                        <td class="has-text-weight-bold">Teacher ID</td>
                        <td><input class="input is-primary" type="text" name="teacher_id" id="teacher_inputID" disabled
                                placeholder="Field Auto. Generated"></td>
                    </tr>
                    <tr>
                        <td class="has-text-weight-bold">Surname</td>
                        <td><input class="input is-primary" type="text" name="surname"></td>
                    </tr>
                    <tr>
                        <td class="has-text-weight-bold">First name</td>
                        <td><input class="input is-primary" type="text" name="first_name"></td>
                    </tr>
                    <tr>
                        <td class="has-text-weight-bold">Instructing Modules</td>
                        <td><input class="input is-primary" type="text" name="instructing_modules"></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <button class="button mb-2 is-rounded is-primary is-outlined" id="create-button-t"
                                onclick="doCreateTeacher()">Create</button>
                            <button class="button mb-2 is-rounded is-primary is-outlined" id="update-button-t"
                                onclick="doUpdateTeacher()">Update</button>
                            <button class="button is-rounded is-danger is-outlined" id="cancel-button-t"
                                onclick="returnTeacherInfoPage()">Cancel</button>
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Javascript commands to display/hide elements within the static html index page -->
        <script>
            function returnHomePage() {
                document.getElementById('selection_page').style.display = "flex"
                document.getElementById('displayStudent').style.display = "none"
                document.getElementById('displayTeacher').style.display = "none"
                document.getElementById('create-update-t').style.display = "none"
                document.getElementById('create-update-s').style.display = "none"
                location.reload()
            }

            function returnStudentInfoPage() {
                document.getElementById('selection_page').style.display = "none"
                document.getElementById('displayStudent').style.display = "flex"
                document.getElementById('create-update-s').style.display = "none"
                clearFormStudent()
            }

            function returnTeacherInfoPage() {
                document.getElementById('selection_page').style.display = "none"
                document.getElementById('displayTeacher').style.display = "flex"
                document.getElementById('create-update-t').style.display = "none"
                clearFormTeacher()
            }

            function displayStudentInfoPage() {
                document.getElementById('selection_page').style.display = "none"
                document.getElementById('displayStudent').style.display = "flex"
                document.getElementById('create-update-s').style.display = "none"
                populateTableStudent()
            }

            function displayTeacherInfoPage() {
                document.getElementById('selection_page').style.display = "none"
                document.getElementById('displayTeacher').style.display = "flex"
                document.getElementById('create-update-t').style.display = "none"
                populateTableTeacher()
            }

            function showCreateStudent() {
                document.getElementById('displayStudent').style.display = "none"
                document.getElementById('update-button-s').style.display = "none"
                document.getElementById('create-button-s').style.display = "flex"
                document.getElementById('create-update-s').style.display = "flex"
                document.getElementById('cancel-button-s').style.display = "flex"

                document.getElementById('student_inputID').disabled = true
            }

            function showCreateTeacher() {
                document.getElementById('displayTeacher').style.display = "none"
                document.getElementById('update-button-t').style.display = "none"
                document.getElementById('create-button-t').style.display = "flex"
                document.getElementById('create-update-t').style.display = "flex"
                document.getElementById('cancel-button-t').style.display = "flex"

                document.getElementById('teacher_inputID').disabled = true
            }

            function showUpdateStudent(thisElem) {
                var rowElement = thisElem.parentNode.parentNode;
                var student = readStudentFromRow(rowElement)
                // The form is filled with the student info
                populateFormStudent(student)

                document.getElementById('displayStudent').style.display = "none"
                document.getElementById('update-button-s').style.display = "flex"
                document.getElementById('create-button-s').style.display = "none"
                document.getElementById('create-update-s').style.display = "flex"

            }

            function showUpdateTeacher(thisElem) {
                var rowElement = thisElem.parentNode.parentNode;
                var teacher = readTeacherFromRow(rowElement)
                // The form is filled with the teacher info
                populateFormTeacher(teacher)

                document.getElementById('displayTeacher').style.display = "none"
                document.getElementById('update-button-t').style.display = "flex"
                document.getElementById('create-button-t').style.display = "none"
                document.getElementById('create-update-t').style.display = "flex"
            }

            function readStudentFromRow(rowElement) {
                student = {}
                student.student_id = rowElement.getAttribute("id");
                student.surname = rowElement.cells[1].firstChild.textContent
                student.first_name = rowElement.cells[2].firstChild.textContent
                student.registered_modules = rowElement.cells[3].firstChild.textContent

                return student
            }

            function readTeacherFromRow(rowElement) {
                teacher = {}
                teacher.teacher_id = rowElement.getAttribute("id");
                teacher.surname = rowElement.cells[1].firstChild.textContent
                teacher.first_name = rowElement.cells[2].firstChild.textContent
                teacher.instructing_modules = rowElement.cells[3].firstChild.textContent

                return teacher
            }

            function populateFormStudent(student) {
                var form = document.getElementById('createUpdateFormStudent')

                form.querySelector('input[name="student_id"]').value = student.student_id
                form.querySelector('input[name="student_id"]').disabled = true

                form.querySelector('input[name="surname"]').value = student.surname
                form.querySelector('input[name="first_name"]').value = student.first_name
                form.querySelector('input[name="registered_modules"]').value = student.registered_modules
            }

            function populateFormTeacher(teacher) {
                var form = document.getElementById('createUpdateFormTeacher')

                form.querySelector('input[name="teacher_id"]').value = teacher.teacher_id
                form.querySelector('input[name="teacher_id"]').disabled = true

                form.querySelector('input[name="surname"]').value = teacher.surname
                form.querySelector('input[name="first_name"]').value = teacher.first_name
                form.querySelector('input[name="instructing_modules"]').value = teacher.instructing_modules
            }

            function clearFormStudent() {
                var form = document.getElementById('createUpdateFormStudent')

                form.querySelector('input[name="student_id"]').value = ''
                form.querySelector('input[name="student_id"]').disabled = false

                form.querySelector('input[name="surname"]').value = ''
                form.querySelector('input[name="first_name"]').value = ''
                form.querySelector('input[name="registered_modules"]').value = ''
            }

            function clearFormTeacher() {
                var form = document.getElementById('createUpdateFormTeacher')

                form.querySelector('input[name="teacher_id"]').value = ''
                form.querySelector('input[name="teacher_id"]').disabled = false

                form.querySelector('input[name="surname"]').value = ''
                form.querySelector('input[name="first_name"]').value = ''
                form.querySelector('input[name="instructing_modules"]').value = ''
            }

            host = window.location.origin
            // ajax get call to read in the information from the database table student_info
            function populateTableStudent() {
                $.ajax({
                    url: host+'/students',
                    method: 'GET',
                    dataType: 'JSON',
                    success: function (results) {
                        for (student of results) {
                            addStudentToTable(student)
                        }
                    },
                    error: function (xhr, status, error) {
                        console.log("error" + error + " code:" + status)
                    }

                })
            }

            // ajax get call to read in the information from the database table teacher_info
            function populateTableTeacher() {
                $.ajax({
                    url: host+'/teachers',
                    method: 'GET',
                    dataType: 'JSON',
                    success: function (results) {
                        for (teacher of results) {
                            addTeacherToTable(teacher)
                        }
                    },
                    error: function (xhr, status, error) {
                        console.log("error" + error + " code:" + status)
                    }

                })
            }

            // Ajax call to create a student within the database table student_info
            function doCreateStudent() {
                student = getStudentFromForm()
                $.ajax({
                    url: host+"/students",
                    data: JSON.stringify(student),
                    method: "POST",
                    dataType: "JSON",
                    contentType: "application/json; charset=utf-8",
                    success: function (result) {
                        console.log(result)
                        student.student_id = result
                        addStudentToTable(student)
                        returnStudentInfoPage()
                        clearFormStudent()
                    },
                    error: function (xhr, status, error) {
                        console.log("error" + error)
                    }
                })
            }
            // Ajax call to create a teacher within the database table teacher_info
            function doCreateTeacher() {
                teacher = getTeacherFromForm()
                $.ajax({
                    url: host+"/teachers",
                    data: JSON.stringify(teacher),
                    method: "POST",
                    dataType: "JSON",
                    contentType: "application/json; charset=utf-8",
                    success: function (result) {
                        console.log(result)
                        teacher.teacher_id = result
                        addTeacherToTable(teacher)
                        returnTeacherInfoPage()
                        clearFormTeacher()
                    },
                    error: function (xhr, status, error) {
                        console.log("error" + error)
                    }
                })
            }

            // Update the web page table (HTML) and database table
            function doUpdateStudent() {
                student = getStudentFromForm()
                updateServerStudent(student)
            }

            function doUpdateTeacher() {
                teacher = getTeacherFromForm()
                updateServerTeacher(teacher)
            }

            // Ajax Update call
            function updateServerStudent(student) {
                $.ajax({
                    url: host+"/students/" + student.student_id,
                    data: JSON.stringify(student),
                    method: "PUT",
                    dataType: "JSON",
                    contentType: "application/json; charset=utf-8",
                    success: function (result) {
                        updateTableRowStudent(student)
                        returnStudentInfoPage()
                        clearFormStudent()
                    },
                    error: function (xhr, status, error) {
                        console.log("error" + error)
                    }
                })
            }

            // Ajax Update call
            function updateServerTeacher(teacher) {
                $.ajax({
                    url: host+"/teachers/" + teacher.teacher_id,
                    data: JSON.stringify(teacher),
                    method: "PUT",
                    dataType: "JSON",
                    contentType: "application/json; charset=utf-8",
                    success: function (result) {
                        updateTableRowTeacher(teacher)
                        returnTeacherInfoPage()
                        clearFormTeacher()
                    },
                    error: function (xhr, status, error) {
                        console.log("error" + error)
                    }
                })
            }
            // Ajax delete call
            function doDeleteStudent(thisElem) {
                var tableElement = document.getElementById('student_Table');
                var rowElement = thisElem.parentNode.parentNode;
                var index = rowElement.rowIndex;
                student_id = rowElement.getAttribute("id");
                $.ajax({
                    url: host+"/students/" + student_id,
                    method: "DELETE",
                    dataType: "JSON",
                    contentType: "application/json; charset=utf-8",
                    success: function (result) {
                        tableElement.deleteRow(index);
                    },
                    error: function (xhr, status, error) {
                        console.log(error)
                    }
                })


            }

            // Ajax delete call
            function doDeleteTeacher(thisElem) {
                var tableElement = document.getElementById('teacher_Table');
                var rowElement = thisElem.parentNode.parentNode;
                var index = rowElement.rowIndex;
                teacher_id = rowElement.getAttribute("id");
                $.ajax({
                    url: host+"/teachers/" + teacher_id,
                    method: "DELETE",
                    dataType: "JSON",
                    contentType: "application/json; charset=utf-8",
                    success: function (result) {
                        tableElement.deleteRow(index);
                    },
                    error: function (xhr, status, error) {
                        console.log(error)
                    }
                })
            }

            function updateTableRowStudent(student) {
                var rowElement = document.getElementById(student.student_id)
                rowElement.cells[1].firstChild.textContent = student.surname
                rowElement.cells[2].firstChild.textContent = student.first_name
                rowElement.cells[3].firstChild.textContent = student.registered_modules
            }

            function updateTableRowTeacher(teacher) {
                var rowElement = document.getElementById(teacher.teacher_id)
                rowElement.cells[1].firstChild.textContent = teacher.surname
                rowElement.cells[2].firstChild.textContent = teacher.first_name
                rowElement.cells[3].firstChild.textContent = teacher.instructing_modules
            }

            function getStudentFromForm() {
                var form = document.getElementById('createUpdateFormStudent')
                var student = {}
                student.student_id = form.querySelector('input[name="student_id"]').value
                student.surname = form.querySelector('input[name="surname"]').value
                student.first_name = form.querySelector('input[name="first_name"]').value
                student.registered_modules = form.querySelector('input[name="registered_modules"]').value
                return student
            }

            function getTeacherFromForm() {
                var form = document.getElementById('createUpdateFormTeacher')
                var teacher = {}
                teacher.teacher_id = form.querySelector('input[name="teacher_id"]').value
                teacher.surname = form.querySelector('input[name="surname"]').value
                teacher.first_name = form.querySelector('input[name="first_name"]').value
                teacher.instructing_modules = form.querySelector('input[name="instructing_modules"]').value
                return teacher
            }



            // After an entry had been created add this new entry to the table i.e., a new student
            function addStudentToTable(student) {
                tableElem = document.getElementById("student_Table")
                rowElem = tableElem.insertRow(-1)
                // The line below helps the delete code function
                rowElem.setAttribute("id", student.student_id)

                cell1 = rowElem.insertCell(0)
                cell1.innerHTML = student.student_id

                cell2 = rowElem.insertCell(1)
                cell2.innerHTML = student.surname

                cell3 = rowElem.insertCell(2)
                cell3.innerHTML = student.first_name

                cell4 = rowElem.insertCell(3)
                cell4.innerHTML = student.registered_modules

                cell5 = rowElem.insertCell(4)
                cell5.innerHTML = '<button class="button is-small is-rounded is-primary is-outlined" onclick="showUpdateStudent(this)">Update</button>'

                cell6 = rowElem.insertCell(5)
                cell6.innerHTML = '<button class="button is-small is-rounded is-danger is-outlined" onclick="doDeleteStudent(this)">Delete</button>'
            }

            // After an entry had been created add this new entry to the table i.e., a new student
            function addTeacherToTable(teacher) {
                tableElem = document.getElementById("teacher_Table")
                rowElem = tableElem.insertRow(-1)
                // The line below helps the delete code function
                rowElem.setAttribute("id", teacher.teacher_id)

                cell1 = rowElem.insertCell(0)
                cell1.innerHTML = teacher.teacher_id

                cell2 = rowElem.insertCell(1)
                cell2.innerHTML = teacher.surname

                cell3 = rowElem.insertCell(2)
                cell3.innerHTML = teacher.first_name

                cell4 = rowElem.insertCell(3)
                cell4.innerHTML = teacher.instructing_modules

                cell5 = rowElem.insertCell(4)
                cell5.innerHTML = '<button class="button is-small is-rounded is-primary is-outlined" onclick="showUpdateTeacher(this)">Update</button>'

                cell6 = rowElem.insertCell(5)
                cell6.innerHTML = '<button class="button is-small is-rounded is-danger is-outlined" onclick="doDeleteTeacher(this)">Delete</button>'

            }
        </script>
    </section>
</body>

</html>